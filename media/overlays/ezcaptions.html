<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EzLay - Alphatest</title>
	<link rel="icon" type="image/png" href="/assets/images/logo/pixelbotfavicon.png">
	<link rel="stylesheet" href="/core/css/animations.css">
	<link rel="stylesheet" href="/core/css/pixelb8-holotheme.css">
	<link href="https://fonts.googleapis.com/css2?family=Yatra+One&amp;display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:ital,wght@1,700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
</head>

<style>
  #captions {
    position: fixed;
    bottom: 10%;
	height:min-content;
    left: 50%;
    transform: translateX(-50%);
    font-size: 2rem;
    padding: 0.5rem 1rem;
    color: white;
    background-color: rgba(0, 0, 0, 0.6);
    text-shadow: 2px 2px 4px black;
    border-radius: 0.5rem;
    z-index: 10000;
    transition: all 0.3s ease;
  }

  .fade-out {
    opacity: 0;
    transition: opacity 0.5s ease;
  }

  #caption-controls {
    position: fixed;
    top: 1%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(30, 30, 30, 0.85);
    color: white;
    padding: 1rem;
    border-radius: 0.5rem;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    font-size: 0.9rem;
    z-index: 10001;
  }

  #caption-controls label {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

</style>
	<body>
		<div id="underlay"></div>
	<script>
	// 🧱 Add missing UI elements if not already present
	function ensureUIElements() {
	  if (!document.getElementById("underlay")) {
		const underlay = document.createElement("div");
		underlay.id = "underlay";
		underlay.style.position = "fixed";
		underlay.style.top = 0;
		underlay.style.left = 0;
		underlay.style.width = "100%";
		underlay.style.height = "100%";
		underlay.style.pointerEvents = "none";
		underlay.style.zIndex = "9998";
		document.body.appendChild(underlay);
	  }

	  if (!document.getElementById("captions")) {
		const captions = document.createElement("div");
		captions.id = "captions";
		captions.style.position = "fixed";
		captions.style.bottom = "10%";
		captions.style.width = "100%";
		captions.style.textAlign = "center";
		captions.style.fontSize = "2rem";
		captions.style.color = "white";
		captions.style.textShadow = "2px 2px 8px black";
		captions.style.zIndex = "9999";
		captions.style.transition = "opacity 1s ease";
		captions.classList.add("fade-out");
		document.body.appendChild(captions);
	  }

	  if (!document.getElementById("output")) {
		const output = document.createElement("div");
		output.id = "output";
		output.style.position = "fixed";
		output.style.top = "10px";
		output.style.left = "10px";
		output.style.fontSize = "1rem";
		output.style.color = "white";
		output.style.zIndex = "9999";
		document.body.appendChild(output);
	  }

	  if (!document.getElementById("voice-btn")) {
		const btn = document.createElement("button");
		btn.id = "voice-btn";
		btn.textContent = "🎤 Start Voice";
		btn.style.position = "fixed";
		btn.style.bottom = "10px";
		btn.style.left = "10px";
		btn.style.zIndex = "10000";
		document.body.appendChild(btn);
	  }

	  if (!document.getElementById("stop-voice-btn")) {
		const btn = document.createElement("button");
		btn.id = "stop-voice-btn";
		btn.textContent = "🛑 Stop Voice";
		btn.style.position = "fixed";
		btn.style.bottom = "10px";
		btn.style.left = "130px";
		btn.style.zIndex = "10000";
		btn.disabled = true;
		document.body.appendChild(btn);
	  }

	  // Optional: Basic fade-out class
	  const style = document.createElement("style");
	  style.textContent = `
		.fade-out {
		  opacity: 0;
		}
	  `;
	  document.head.appendChild(style);
	}

	ensureUIElements();

	function poopSplat() {
	  const poop = document.createElement("div");
	  poop.textContent = "💩";
	  poop.style.position = "fixed";

	  const top = Math.random() * 80 + 10;
	  const left = Math.random() * 80 + 10;
	  const size = Math.random() * 4 + 2;
	  const rotation = Math.floor(Math.random() * 360);

	  poop.style.top = `${top}%`;
	  poop.style.left = `${left}%`;
	  poop.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
	  poop.style.fontSize = `${size}rem`;
	  poop.style.opacity = "0";
	  poop.style.transition = "opacity 0.4s ease";
	  poop.style.zIndex = "9999";
	  poop.style.pointerEvents = "none";

	  document.getElementById("underlay").appendChild(poop);

	  requestAnimationFrame(() => {
		poop.style.opacity = "1";
	  });

	  setTimeout(() => {
		poop.style.opacity = "0";
		setTimeout(() => {
		  poop.remove();
		}, 400);
	  }, 1100);
	}

	// 🎙️ Voice Recognition Logic
	const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
	let closedCaptionsEnabled = true;

	if (SpeechRecognition) {
	  const recognition = new SpeechRecognition();
	  recognition.lang = 'en-US';
	  recognition.interimResults = true;
	  recognition.maxAlternatives = 1;
	  recognition.continuous = true;

	  const output = document.getElementById('output');
	  const startBtn = document.getElementById('voice-btn');
	  const stopBtn = document.getElementById('stop-voice-btn');

	  let isListening = true;

	  startBtn.addEventListener('click', () => {
		isListening = true;
		recognition.start();
		output.textContent = "🎙️ Listening...";
		startBtn.disabled = true;
		stopBtn.disabled = false;
	  });

	  stopBtn.addEventListener('click', () => {
		isListening = false;
		recognition.stop();
		output.textContent = "🛑 Stopped listening.";
		startBtn.disabled = false;
		stopBtn.disabled = true;
	  });

	  recognition.addEventListener('result', (event) => {
		let finalTranscript = "";
		let interimTranscript = "";

		for (let i = event.resultIndex; i < event.results.length; ++i) {
		  const transcript = event.results[i][0].transcript.trim();
		  if (event.results[i].isFinal) {
			finalTranscript += transcript + " ";
		  } else {
			interimTranscript += transcript + " ";
		  }
		}

		const captionsDiv = document.getElementById("captions");
		if (closedCaptionsEnabled && captionsDiv) {
		  captionsDiv.textContent = interimTranscript || finalTranscript;
		}

		const finalLower = finalTranscript.toLowerCase();

		if (finalLower.includes("spin wheel")) pullDiscRotationLever?.();
		if (finalLower.includes("play trivia")) startentrivia?.();
		if (finalLower.includes("put a random question on the screen")) startentriviaAsk?.();
		if (interimTranscript.toLowerCase().includes("poop")) poopSplat();

		if (finalTranscript) {
		  output.textContent = `🗣️ You said: "${finalTranscript.trim()}"`;
		  if (captionsDiv) captionsDiv.textContent = finalTranscript.trim();
		}

		let fadeTimeout;
		if (closedCaptionsEnabled && captionsDiv) {
		  captionsDiv.textContent = interimTranscript || finalTranscript;
		  captionsDiv.classList.remove('fade-out');

		  clearTimeout(fadeTimeout);
		  fadeTimeout = setTimeout(() => {
			captionsDiv.classList.add('fade-out');
		  }, 4000);
		}
	  });

	  recognition.addEventListener('end', () => {
		if (isListening) {
		  console.log("Recognition ended, restarting...");
		  recognition.start();
		} else {
		  console.log("Recognition stopped by user.");
		}
	  });
	}
	</script>
<script>
// Create or get element helper
function createIfMissing(id, tag = "div") {
  let el = document.getElementById(id);
  if (!el) {
    el = document.createElement(tag);
    el.id = id;
    document.body.appendChild(el);
  }
  return el;
}

// Inject Captions Div
const captionsDiv = createIfMissing("captions");
captionsDiv.style.position = "fixed";
captionsDiv.style.bottom = "10%";
captionsDiv.style.left = "50%";
captionsDiv.style.transform = "translateX(-50%)";
captionsDiv.style.fontSize = "2rem";
captionsDiv.style.padding = "0.5rem 1rem";
captionsDiv.style.borderRadius = "0.5rem";
captionsDiv.style.zIndex = "10000";
captionsDiv.style.transition = "all 0.3s ease";

// Inner span for actual caption text
let captionText = document.getElementById("caption-text");
if (!captionText) {
  captionText = document.createElement("span");
  captionText.id = "caption-text";
  captionsDiv.appendChild(captionText);
}

// Inject Control Panel
if (!document.getElementById("caption-controls")) {
  const controls = document.createElement("div");
  controls.id = "caption-controls";
  controls.innerHTML = `
    <style>
      #caption-controls {
        position: fixed;
        bottom: 1%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(30, 30, 30, 0.9);
        color: white;
        padding: 1rem;
        border-radius: 0.5rem;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        font-size: 0.9rem;
        z-index: 10001;
      }
      #caption-controls label {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      #toggle-controls {
        position: fixed;
        bottom: 1%;
        right: 1%;
        background: #444;
        color: white;
        border: none;
        padding: 0.5rem 0.8rem;
        border-radius: 0.3rem;
        z-index: 10002;
        cursor: pointer;
      }
    </style>
    <label>
      Shadow Size
      <input type="range" id="shadow-size" min="0" max="20" step="1">
    </label>
    <label>
      Shadow Color
      <input type="color" id="shadow-color">
    </label>
    <label>
      Text Color
      <input type="color" id="text-color">
    </label>
    <label>
      Background Color
      <input type="color" id="bg-color">
    </label>
    <label>
      Blur Glow
      <input type="checkbox" id="blur-glow">
    </label>
    <label>
      Outline
      <input type="checkbox" id="outline-text">
    </label>
    <button id="reset-captions" style="margin-top: 0.5rem; padding: 0.3rem 0.6rem; background: #222; color: white; border: none; border-radius: 0.3rem; cursor: pointer;">Reset to Default</button>
  `;
  document.body.appendChild(controls);

  // Toggle Button
  const toggleBtn = document.createElement("button");
  toggleBtn.id = "toggle-controls";
  toggleBtn.textContent = "⚙️ Captions Settings";
  toggleBtn.addEventListener("click", () => {
    const panel = document.getElementById("caption-controls");
    panel.style.display = panel.style.display === "none" ? "flex" : "none";
  });
  document.body.appendChild(toggleBtn);
}

// === Style Handler ===
function updateCaptionStyles() {
  const size = document.getElementById("shadow-size").value;
  const color = document.getElementById("shadow-color").value;
  const text = document.getElementById("text-color").value;
  const bg = document.getElementById("bg-color").value;
  const blur = document.getElementById("blur-glow").checked;
  const outline = document.getElementById("outline-text").checked;

  // Text shadow
  let textShadow = `${size}px ${size}px ${size}px ${color}`;
  if (blur) {
    textShadow += `, 0 0 ${size * 2}px ${color}`;
  }

  // Apply styles to inner text
  captionText.style.textShadow = textShadow;
  captionText.style.color = text;
  captionText.style.webkitTextStroke = outline ? "1px black" : "0";

  // Apply background to outer wrapper
  captionsDiv.style.backgroundColor = bg;

  // Save settings
  localStorage.setItem("captionPrefs", JSON.stringify({
    size, color, text, bg, blur, outline
  }));
}

// === Load Settings on Init ===
function loadCaptionStyles() {
  const saved = JSON.parse(localStorage.getItem("captionPrefs") || "{}");

  document.getElementById("shadow-size").value = saved.size || 4;
  document.getElementById("shadow-color").value = saved.color || "#000000";
  document.getElementById("text-color").value = saved.text || "#ffffff";
  document.getElementById("bg-color").value = saved.bg || "#000000";
  document.getElementById("blur-glow").checked = saved.blur || false;
  document.getElementById("outline-text").checked = saved.outline || false;

  updateCaptionStyles();
}

// Reset to Default Handler
document.getElementById("reset-captions").addEventListener("click", () => {
  const defaults = {
    size: 4,
    color: "#000000",
    text: "#ffffff",
    bg: "#000000",
    blur: false,
    outline: false
  };

  document.getElementById("shadow-size").value = defaults.size;
  document.getElementById("shadow-color").value = defaults.color;
  document.getElementById("text-color").value = defaults.text;
  document.getElementById("bg-color").value = defaults.bg;
  document.getElementById("blur-glow").checked = defaults.blur;
  document.getElementById("outline-text").checked = defaults.outline;

  updateCaptionStyles();
});

// Hook up all input events
[
  "shadow-size", "shadow-color", "text-color",
  "bg-color", "blur-glow", "outline-text"
].forEach(id => {
  const el = document.getElementById(id);
  if (el) el.addEventListener("input", updateCaptionStyles);
});

// Run on page load
loadCaptionStyles();
</script>

	</body>
</html>