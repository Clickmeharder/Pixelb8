<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>entrivia-v1.00</title>
	<style>
		/* Trivia Control Button */
		#trivia-toggle {
			position: fixed;
			top: 10px;
			left: 10px;
			width: 40px;
			height: 40px;
			border-radius: 50%;
			background-color: #3498db;
			color: white;
			border: none;
			font-size: 32px;
			cursor: pointer;
			transition: opacity 0.3s ease, background-color 0.3s ease, transform 0.2s ease;
			z-index: 1000;
			opacity: 0.65;
		}

		#trivia-toggle:hover {
			background-color: #2980b9;
			transform: scale(1.1);
			opacity: 1;
		}

		/* Trivia Control Container */
		#triviacontrolContainer {
			position: fixed;
			top: 10px;
			left: 10px;
			width: 350px;
			padding: 10px;
			background: rgba(0, 0, 0, 0.9);
			color: white;
			border-radius: 8px;
			box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
			opacity: 0; /* Start hidden */
			transform: translateY(-10px); /* Slight slide-up effect */
			transition: opacity 0.4s ease-out, transform 0.4s ease-out;
			pointer-events: none; /* Prevent interaction when hidden */
			z-index: 999;
		}

		/* When active (visible) */
		#triviacontrolContainer.active {
			opacity: 1;
			transform: translateY(0);
			pointer-events: all; /* Allow interactions */
		}

		/* Trivia Input */
		#triviacontrolContainer input[type="text"] {
			width: 92%;
			font-size: larger;
			text-align: center;
			padding: 5px;
			margin: 5px 0;
			border: 3px inset #ccc;
			border-radius: 5px;
		}

		/* Trivia Buttons */
		#triviacontrolContainer button {
			width: 100%;
			padding: 9px;
			margin: 5px 0;
			border: 2px ridge #1f9fb8;
			background: #305a62;
			color: #00fff9;
			font-size: x-large;
			border-radius: 5px;
			cursor: pointer;
			transition: background 0.3s ease, color: 0.3s ease;
		}

		#triviacontrolContainer button:hover {
			background: #27ae60;
			color: #0e5b75;
		}
		/* Trivia Settings */
		div#trivia-settings {
			text-align: start;
			display: flex;
			flex-direction: column;
			border: 3px inset #8b8585;
			overflow: hidden;
			max-height: 20px; /* Initially small */
			padding: 0 10px; /* Horizontal padding stays */
			transition: max-height 0.6s ease-out, padding 0.3s ease-out;
		}

		div#trivia-settings:hover {
			max-height: 500px; /* Expands smoothly */
			padding: 10px; /* Adds padding when expanded */
		}
		/* Trivia Settings Header */
		#trivia-settingsheader {
			font-weight: bold;
			font-size: 16px;
			margin-bottom: 5px;
			display: block;
		}
	</style>
    <style>
		body {
			font-family: Arial, sans-serif;
			color: orangered;
			text-align: center;
			margin: 0;
			padding: 0;
			width: 100vw;
			height: 100vh;
		}
		#triviaAnnouncementWrapper {
			display: none;
			opacity: 1;
			position: absolute;
			top: 71%;
			left: 2px;
			width: 25%;
			max-width: 25%;
			text-align: center;
			padding: 15px 20px;
			background: linear-gradient(135deg, #001f1f, #004040);
			border: 3px solid teal;
			border-radius: 12px;
			box-shadow: 0px 0px 12px rgba(0, 255, 255, 0.5);
		}
		#triviaAnnouncement {
			font-weight: bold;
			text-align: center;
			color: white;
			text-shadow: 2px 2px 4px rgba(0, 255, 255, 0.5);
		}
		#questionWrapper {
			position: absolute;
			top: 71%;
			left: 2px;
			width: 25%;
			max-width: 25%;
			text-align: center;
			padding: 15px 20px;
			background: linear-gradient(135deg, #001f1f, #004040);
			border: 3px solid teal;
			border-radius: 12px;
			box-shadow: 0px 0px 12px rgba(0, 255, 255, 0.5);
		}
		#question {
			font-weight: bold;
			text-align: center;
			color: white;
			text-shadow: 2px 2px 4px rgba(0, 255, 255, 0.5);
		}

		p#question-counter {
			margin: 0;
		}
		#triviaboard {
			position: absolute;
			top: 0%;
			font-size: 15px;
			right: 0;
			margin:0;
		}
		#triviaboard p {
			background: #001f1f;
			width: 155px;
			padding: 4px;
			margin: 0px;
			font-size: 18px;
			border: 2px outset #095656;
			border-radius: 0px;
		}
		#triviaboard li {
			margin: -6px 0 0px 0;
			text-align: center;
			padding: 4px 9px;
			background: linear-gradient(135deg, #001f1f, #004040);
			border: 3px solid teal;
			border-radius: 12px;
			color: #12ebeb;
			text-shadow: 1px 1px 4px rgb(0 255 239 / 65%);
			box-shadow: 0px 0px 12px rgb(0 255 239 / 65%);
		}
		#timer, #timeuntil-nextQ {font-size: 20px;font-weight: bold;color: lightblue;}
		div#timeuntil-nextQ {position: absolute;bottom: 24%;left: 2%;}
				
		/* Trivia Splash Centering */
		#triviaSplash {
			position: fixed;
			top: 28vh;
			left: 0;
			text-align: center;
			z-index: 9999;
			opacity: 0;
			visibility: hidden;
			width: 60%;
			max-width: 582px;
			padding: 3px;
			box-sizing: border-box;
			/*border: 5px dashed darkgrey;*/
		}


		/* Logo Container for Proper Scaling */
		#logoContainer {
			/*border: 1px dotted red;*/
		}

		/* Actual Logo Scaling */
		#triviaLogo {
			height: auto;
			max-width: 37vw;
			max-height: 38vh;
			opacity: 0;
			transform: scale(0.5) rotate(-15deg);
			animation: logoDropIn 2s ease-out forwards, glowPulse 3s infinite alternate 2s;
		}

		/* Splash Text Styling */
		#splashText {
			position: absolute;
			text-align: center;
			left: 44%;
			bottom: 3%;
			width: 153px;
			font-size: 31px;
			font-weight: bold;
			color: #0ea4a4;
			opacity: 0;
			animation: textReveal 2s ease-out 3s forwards;
		}

		/* ANIMATIONS */

		/* Logo Drop-In */
		@keyframes logoDropIn {
			0% {
				opacity: 0;
				transform: scale(0.5) rotate(-15deg);
			}
			50% {
				opacity: 1;
				transform: scale(1.2) rotate(5deg);
			}
			100% {
				opacity: 1;
				transform: scale(1) rotate(0deg);
			}
		}

		/* Glow Pulse */
		@keyframes glowPulse {
			0% {
				filter: drop-shadow(0 0 5px #0ea4a4);
			}
			100% {
				filter: drop-shadow(0 0 15px #0ea4a4);
			}
		}

		/* Text Reveal */
		@keyframes textReveal {
			0% {
				opacity: 0;
				transform: translateY(10px);
			}
			50% {
				opacity: 1;
				transform: translateY(0);
			}
			100% {
				opacity: 1;
				text-shadow: 0px 0px 10px #0ea4a4;
			}
		}

		/* Fade In */
		@keyframes fadeIn {
			from { opacity: 0; transform: translateY(10px); }
			to { opacity: 1; transform: translateY(0); }
		}

		/* Fade Out */
		@keyframes fadeOut {
			from { opacity: 1; transform: translateY(0); }
			to { opacity: 0; transform: translateY(-10px); }
		}

		/* Slide In */
		@keyframes slideIn {
			from { opacity: 0; transform: translateX(-50px); }
			to { opacity: 1; transform: translateX(0); }
		}

		/* Slide Out */
		@keyframes slideOut {
			from { opacity: 1; transform: translateX(0); }
			to { opacity: 0; transform: translateX(50px); }
		}


		@keyframes oldlogoDropIn {
			0% {
				opacity: 0;
				transform: scale(0.5) rotate(-15deg);
			}
			50% {
				opacity: 1;
				transform: scale(1.2) rotate(5deg);
			}
			100% {
				transform: scale(1) rotate(0deg);
			}
		}

		@keyframes oldglowPulse {
			0% { filter: drop-shadow(0 0 5px #0ea4a4); }
			100% { filter: drop-shadow(0 0 15px #0ea4a4); }
		}
		@keyframes oldtextReveal {
			0% { opacity: 0; transform: translateY(10px); }
			50% { opacity: 1; transform: translateY(0px); }
			100% { text-shadow: 0px 0px 10px #0ea4a4; }
		}

		/* Hidden state */
		.hidden {
			opacity: 0;
			visibility: hidden;
			pointer-events: none;
		}



		#TriviaWrapper {height: 100vh;visibility: hidden;opacity: 0;transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;}

		#triviaPodium {
			position: absolute;
			bottom: 38%;
			left: 20%;
			display: flex;
			flex-direction: row;
			flex-wrap: wrap;
			flex-direction: column;
			gap: 15px;
			align-items: center;
			align-content: flex-start;
			z-index: 1000;
		}
		.winner {text-align: center;}
		.winner img {border-radius: 50%;width: 100px;height: 100px;margin-bottom: 10px;}
		.winner-name {
			font-size: 1.9em;
			font-weight: bold;
			margin: 0px;
			padding: 0px;
			padding-left: 6px;
			padding-right: 6px;
			border: 5px ridge teal;
			border-color: teal;
		}
		.winner-score {
			font-size: 1em;
			font-weight: bold;
			color: #19e607;
			background-color: #000000d4;
			margin: 0;
		}
		.extraStats p { 
			margin: 0;
		}
		div#first {
			padding: 4px;
			background: linear-gradient(135deg, #001f1f, #004040);
			border: 2px outset gold;
			border-radius: 50%;
			box-shadow: 0px 0px 24px rgb(255 128 0 / 84%);
		}
		div#secondandthirdplace {
			display: flex;
			flex-direction: row;
			gap: 100px;
			padding: 8px;
		}
		div#triviarunnerups {
			display: flex;
			gap: 20px;
		}
		p#winner4Name {
			max-width: 142px;
			overflow: hidden;
		}
		p#winner5Name {
			max-width: 142px;
			overflow: hidden;
		}
		.small {font-size: 0.9em;color: #888;}
				
		#twitchchatContainer {position: absolute;left: 0;bottom: 30%;border: 1px solid #67d1d173;width: 29%;}
		div#twitchMessagebox {text-align: left;border: 2px inset #102d2de3;max-height: 170px;}
		#twitchMessagebox .chatMessage {opacity: 1;transition: opacity 1s ease-out;  /* Apply the fade transition */}
		#username {font-weight:bold;}
		.chatMessage {font-size: 18px;color: white;background-color: #000000c2;border: 1px dashed #696969;}
    </style>
</head>
<body>
	<!--                                                              -->
	<div id="twitchchatContainer">
		<div id="twitchMessagebox">
		</div>
	</div>
	<!--                                                              -->
		<!-- Floating Button -->
	<button id="trivia-toggle">⚙</button>
	<!-- Trivia Control Container -->
	<div id="triviacontrolContainer">
		<img id="streamerPFP" src="" alt="Streamer Profile Picture" />
		<input type="text" name="yourTextName" placeholder="Enter Your Twitch Streamer Name">
		<button id="streamersButt">Connect</button>
		<button id="twitchdisconnectButt" onclick="disconnectBot()">Disconnect from Twitch</button>
		<div id="trivia-controls">
			<button id="startGame">Start Game</button>
			<button id="nextQuestion">Next Question</button>
			<button id="showAnswer">Show Answer</button>
			<button id="cancelGame">End Game</button>
		</div>
		<div id="trivia-settings">
			<span id="trivia-settingsheader">Settings</span>
			<label for="timeBetweenQuestions">Seconds Between Questions:</label>
			<input type="number" id="timeBetweenQuestions" value="5" min="1" step="1">
			<label for="timeToAnswer">Time to Answer (seconds):</label>
			<input type="number" id="timeToAnswer" value="10" min="1" step="1">
			<label for="questionsPerRound">Questions Per Round:</label>
			<input type="number" id="questionsPerRound" value="5" min="1" step="1">
			<label for="numberOfRounds">Number of Rounds:</label>
			<input type="number" id="numberOfRounds" value="3" min="1" step="1">
			<label><input type="checkbox" id="chatAnswersToggle" />Allow Chat Answers</label>
			<button id="saveSettings">Save Settings</button>
		</div>
	</div>
	<div id="triviaOverlay" style="">
		<!-- Wrapper for the Trivia Splash Animation -->
		<div id="triviaSplash" style="display:none;">
			<div id="logoContainer">
				<!-- <img src="../assets/images/logo/pixelbotfavicon.png" alt="Trivia Logo" id="triviaLogo" /> -->
				<img src="/assets/images/jaedrazepfp.png" alt="Trivia Logo" id="triviaLogo" />
			</div>
			<div id="susText">S.u.Stv Presents:</div>
			<div id="splashText">Entrivia Universe</div>
		</div>
		<!-- triviaAnnouncementWrapper -->
		<div id="triviaAnnouncementWrapper">
			<div id="triviaAnnouncement"></div>
			<div id="roundstarttimer"></div>
		</div>
		<!-- Wrapper for the Trivia main elements -->
		<!-- add user trivia rank and rank badges: rank1🥇 rank2🥈 rank3🥉 rank4🏅 rank5-10?🎖️-->
		<div id="TriviaWrapper">
			<!-- Wrapper for the winners' announcement -->
			<!-- Top 3 winners -->
			<div id="triviaPodium" style="display: none;">
				<div id="first">
					<div class="winner" id="winner1">
						<span class="trophy gold">🏆1st</span>
						<p id="winner1Name" class="winner-name">Undefined</p>
						<p id="winner1Score" class="winner-score">score: 0</p>
					</div>
				</div>
				<div id="secondandthirdplace">
					<div id="second">
						<div class="winner" id="winner2">
							<span class="trophy silver">🥈2nd</span>
							<p id="winner2Name" class="winner-name">Undefined69</p>
							<p id="winner2Score" class="winner-score">score: 0</p>
						</div>
					</div>
					<div id="third">
						<div class="winner" id="winner3">
							<span class="trophy bronze">🥉3rd</span>
							<p id="winner3Name" class="winner-name">undefined420</p>
							<p id="winner3Score" class="winner-score">score: 0</p>
						</div>
					</div>
				</div>
				<!-- 4th and 5th place winners (smaller) -->
				<div id="triviarunnerups">
					<div class="winner small" id="winner4">
						<span class="runnerup ribbon">🏅4th</span>
						<p id="winner4Name" class="winner-name">undetermined</p>
						<p id="winner4Score" class="winner-score">score: 0</p>
					</div>
					<div class="winner small" id="winner5">
						<span class="runnerup medal">🎖️5th</span>
						<p id="winner5Name" class="winner-name">mrsuperlongnameguy476</p>
						<p id="winner5Score" class="winner-score">score: 0</p>
					</div>
				</div>
			</div>
			<!-- time until next question -->
			<div id="timeuntil-nextQ"></div>

			<!-- questions wrapper -->
			<div id="questionWrapper">
				<p id="question-counter">Question: 0 / 12</p>
				<div id="question">...</div>
				<div id="timer"></div>
			</div>
			<!-- Trivia leaderboard -->
			<ul id="triviaboard">
				<p>Trivia</p>
			</ul>
		</div>
	</div>
    <script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.js"></script>
    <script>

    </script>
	<script>//trivia options togglebutton
		document.getElementById("trivia-toggle").addEventListener("click", function () {
			let container = document.getElementById("triviacontrolContainer");
			container.classList.toggle("active");
		});
		
		// Get the checkbox element
		const chatAnswersToggle = document.getElementById('chatAnswersToggle');

		// Set up an event listener to update the `chatanswers` variable when the checkbox is toggled
		chatAnswersToggle.addEventListener('change', () => {
			chatanswers = chatAnswersToggle.checked;  // Set chatanswers based on the checkbox
			console.log("Chat answers are now", chatanswers ? "enabled" : "disabled");
		});
	</script>
    <script>
//--------	Chat ---|
// Chat message display function
function displayChatMessage(user, message, flags, extra, isCorrect = false) {
    const chatContainer = document.getElementById("twitchMessagebox");
    // Create a new chat message element
    const chatMessage = document.createElement("div");
    chatMessage.classList.add("chatMessage");

    const usernameSpan = document.createElement("span");
    usernameSpan.classList.add("username");
    usernameSpan.innerHTML = user + ": ";

    const userColor = extra.userColor || "#FFFFFF"; // Default to white if no color is set
    usernameSpan.style.color = userColor; // Apply user color dynamically

    // Create the message element
    const messageSpan = document.createElement("span");
    messageSpan.classList.add("twitchmessage");
    messageSpan.innerHTML = message;
    
    // Append elements to the chat message div
    chatMessage.appendChild(usernameSpan);
    chatMessage.appendChild(messageSpan);
    
    // Add the chat message to the container
    chatContainer.appendChild(chatMessage);
    
    // Apply a fade effect after a delay
    setTimeout(() => {
        chatMessage.style.opacity = '0'; // Fade out after 9 seconds
    }, 15000);
    setTimeout(() => {
        chatMessage.remove();
    }, 15000); // Remove after 15 seconds

    // Limit messages to the last 5
    if (chatContainer.children.length > 5) {
        chatContainer.removeChild(chatContainer.firstChild);
    }
}

function olddisplayChatMessage(user, message, flags, extra) {
    const chatContainer = document.getElementById("twitchMessagebox");
    // Create a new chat message element
    const chatMessage = document.createElement("div");
    chatMessage.classList.add("chatMessage");

    const usernameSpan = document.createElement("span");
    usernameSpan.classList.add("username");
    usernameSpan.innerHTML = user + ": ";

    const userColor = extra.userColor || "#FFFFFF"; // Default to white if no color is set
    usernameSpan.style.color = userColor; // Apply user color dynamically

    // Create the message element and set its innerHTML
    const messageSpan = document.createElement("span");
    messageSpan.classList.add("twitchmessage");
    messageSpan.innerHTML = message;
	
    // Append the username and message spans to the chat message div
    chatMessage.appendChild(usernameSpan);
    chatMessage.appendChild(messageSpan);
	
    // Add the chat message to the container
    chatContainer.appendChild(chatMessage);
    // Apply a fade effect to the chat message after a delay
    setTimeout(() => {
        chatMessage.style.opacity = '0'; // Fade out after 9 seconds
    }, 15000);
    setTimeout(() => {
        chatMessage.remove();
    }, 15000); // Remove after 4 seconds (1 second for fading)

    // Limit the number of messages displayed in the chat container
    if (chatContainer.children.length > 5) {
        chatContainer.removeChild(chatContainer.firstChild);
    }
}
//end of chat logic --------------------|

//---Trivia logic-------------------|
        <!-- const triviaQuestions = [ -->
            <!-- { question: "Converting 100 shrapnel results in how much universal ammo?", answer: "101" }, -->
            <!-- { question: "What number is on the side of a Sleipnir mk1 (C,L)?", answer: "88" }, -->
            <!-- { question: "What is 5 + 3?", answer: "8" }, -->
            <!-- { question: "Who painted the Mona Lisa?", answer: "da vinci" }, -->
            <!-- { question: "What is the smallest Skildek support weapon?", answer: "lancehead" }, -->
            <!-- { question: "What amp drops from bots found at Orthos Oilfield?", answer: "b101" }, -->
            <!-- { question: "What does CDF stand for?", answer: "calypso defense force" }, -->
            <!-- { question: "What does IFN stand for?", answer: "imperial federal navy" }, -->
            <!-- { question: "What is Jaedraze's avatar's first name?", answer: "Jimmy" }, -->
            <!-- { question: "What is Jaedraze's avatar's middle name?", answer: "Jimbobbityboo" }, -->
            <!-- { question: "What year is it?", answer: "2025" }, -->
            <!-- { question: "What items are used to craft explosive projectiles?", answer: "nanocubes" }, -->
            <!-- { question: "What is the name of the starting zone on Calypso?", answer: "thule" }, -->
            <!-- { question: "How many paint cans or textures for max success?", answer: "323" }, -->
            <!-- { question: "How many PED is 100 PEC worth?", answer: "1" }, -->
            <!-- { question: "How many PEC is 1 PED worth?", answer: "100" }, -->
            <!-- { question: "How many PEC is 10 PED worth?", answer: "1000" } -->
        <!-- ]; -->
//--------- TRIVIA -----------




//trivia game code starts here

let triviaGameState = null;
let userStats = {}; // This will store the count of correct answers and first answers
let userOverallStats = {}; // This will store the users lifetime stats ie: number of games played. number of games won. total correct answers total first correct answers
let userScores = {};
let usedQuestions = [];
let activeQuestion = null;
let answeredUsers = new Set();
let firstAnswerUser = null;

let hideQuestionTimer;
let questionTimer, countdownTimer;
let timetoAnswer = 30;
let timebetweenQuestions = 90;
let questionsAsked = 0;
let questionsPerRound = 3;
let round = 1;
let triviaQuestions = { round1: [], round2: [] };
let chatanswers = false;  // Set to true when you want to check answers

<!-- fetch("questions.json") -->
	<!-- .then(response => response.json()) -->
	<!-- .then(data => { -->
		<!-- if (data && data.round1 && data.round1.length > 0) {  -->
			<!-- triviaQuestions = data; -->

		<!-- } else { -->
			<!-- console.error("Trivia questions not found or empty."); -->
		<!-- } -->
	<!-- }) -->
	<!-- .catch(error => console.error("Error loading trivia questions:", error)); -->

// Function to fetch trivia questions
function fetchTriviaQuestions() {
    return new Promise((resolve, reject) => {
        const questionsUrl = 'questions.json'; // Replace with actual path
        fetch(questionsUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load trivia questions');
                }
                return response.json();
            })
            .then(data => {
                if (data && data.round1 && data.round1.length > 0) {
                    triviaQuestions = data;
                    resolve(data);  // Only resolve if data is valid
                } else {
                    throw new Error('Invalid trivia data: Missing or empty rounds.');
                }
            })
            .catch(error => {
                console.error('Error fetching trivia questions:', error);
                reject(error);
            });
    });
}

function showAnnouncement(message, triviaAnnouncementTime) {
    return new Promise((resolve) => {
        const announcementWrapper = document.getElementById("triviaAnnouncementWrapper");
        const triviaAnnouncement = document.getElementById("triviaAnnouncement");
        const roundStartTimer = document.getElementById("roundstarttimer");

        // Set the announcement message
        triviaAnnouncement.innerText = message;

        // If a triviaAnnouncementTime is provided, start the countdown
        if (triviaAnnouncementTime !== undefined) {
            roundStartTimer.style.display = "block"; // Show timer

            const countdownInterval = setInterval(() => {
                roundStartTimer.innerText = `${triviaAnnouncementTime} seconds`;

                // Decrease triviaAnnouncementTime
                triviaAnnouncementTime--;

                if (triviaAnnouncementTime < 0) {
                    clearInterval(countdownInterval);  // Stop the timer
                    roundStartTimer.style.display = "none"; // Hide timer
                    resolve(); // Resolve promise when countdown ends
                }
            }, 1000); // Update every second
        } else {
            // No countdown, resolve after 10 seconds
            setTimeout(() => {
                resolve(); // Resolve promise after 10 seconds
            }, 10000); // Show for 10 seconds
        }

        // Show the announcement wrapper
        announcementWrapper.style.display = "flex";
        announcementWrapper.style.opacity = "1";

        // Fade out announcement after a set time (if no countdown) or after triviaAnnouncementTime
        setTimeout(() => {
            announcementWrapper.style.transition = "opacity 2s ease-in-out";
            announcementWrapper.style.opacity = "0";
        }, triviaAnnouncementTime !== undefined ? triviaAnnouncementTime * 1000 : 10000); // Wait for triviaAnnouncementTime or 10 seconds
    });
}

function splashAnimation() {
    return new Promise((resolve) => {
        const splash = document.getElementById("triviaSplash");
        const logo = document.getElementById("logoContainer");
        const splashText = document.getElementById("splashText");

        // Play the sound
        playSound("gameshowintro");

        // Make splash visible
        splash.style.display = "flex";  // Use flexbox for centering
        splash.style.visibility = "visible";
        splash.style.opacity = "1";  // Fade in

        // Start animations after 1 second (this can be adjusted)
        setTimeout(() => {
            logo.classList.add("animate");  // Apply animation class to logo
            splashText.classList.add("animate");  // Apply animation class to text
        }, 1000); // Delay start of animation (to sync with sound)

        // Fade out splash after a set amount of time (e.g., 13 seconds)
        setTimeout(() => {
            splash.style.transition = "opacity 3s ease-in-out";  // Smooth fade-out transition
            splash.style.opacity = "0";  // Fade out effect

            // After fade-out, hide the splash
            setTimeout(() => {
                splash.style.visibility = "hidden";  // Hide splash
                splash.style.display = "none";  // Ensure it's completely hidden
                resolve();  // Resolve the promise after hiding the splash
            }, 3000);  // Wait for the fade-out duration (3 seconds)
        }, 10000); // Keep splash visible for 13 seconds (adjust as needed)
    });
}

function triviaSplash() {
    return new Promise((resolve) => {
        splashAnimation()  // Show the splash animation
            .then(() => {
                return showAnnouncement("Round starts in:", 30);  // Show announcement with a 30-second countdown
            })
            .then(() => {
                showTrivia();  // Show trivia after the countdown ends
                resolve();  // Resolve the promise after trivia starts
            });
    });
}
function oldtriviaSplash() {
    return new Promise((resolve) => {
        const splash = document.getElementById("triviaSplash");
        const logo = document.getElementById("logoContainer");
        const splashText = document.getElementById("splashText");

        // Play the sound
        playSound("gameshowintro");

        // Make splash visible
        splash.style.display = "flex";  // Use flexbox for centering
        splash.style.visibility = "visible";
        splash.style.opacity = "1";  // Fade in

        // Start animations after 1 second (this can be adjusted)
        setTimeout(() => {
            logo.classList.add("animate");  // Apply animation class
            splashText.classList.add("animate");  // Apply animation class
        }, 1000); // Delay start of animation (to sync with sound)

        // Fade out splash after a set amount of time (e.g., 10 seconds)
        setTimeout(() => {
            splash.style.transition = "opacity 3s ease-in-out";  // Add a smooth fade-out transition
            splash.style.opacity = "0";  // Fade out effect

            // After fade-out, hide the splash
            setTimeout(() => {
                splash.style.visibility = "hidden";  // Hide splash
                splash.style.display = "none";  // Ensure it's completely hidden
                resolve();  // Resolve the promise after hiding the splash
            }, 3000);  // Match the fade-out duration (3 seconds here)
        }, 13000); // Keep splash visible for 13 seconds (adjust as needed)
    }).then(() => {
        showTrivia();  // Show trivia after splash disappears
    });
}



function getRandomQuestion() {
	let currentRound = round === 1 ? "round1" : "round2";
	let availableQuestions = triviaQuestions[currentRound].filter(q => !usedQuestions.includes(q));

	if (availableQuestions.length === 0) {
		usedQuestions = []; // Reset when all questions are used
		availableQuestions = [...triviaQuestions[currentRound]];
	}

	let question = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
	usedQuestions.push(question);
	return question;
}



function nextQuestion() {
    clearTimeout(questionTimer); // Clear previous timer if any
    clearTimeout(hideQuestionTimer); // Assuming hideQuestionTimer exists for hiding the question after time runs out

    activeQuestion = getRandomQuestion();
    answeredUsers.clear();
    firstAnswerUser = null;
    questionsAsked++;
    updateQuestionCounter(); // Update the display

    document.getElementById("question").textContent = activeQuestion.question;
    document.getElementById("questionWrapper").style.visibility = "visible";
    document.getElementById("timer").textContent = timetoAnswer;
    document.getElementById("timeuntil-nextQ").textContent = "";

    let secondsLeft = timetoAnswer;
    questionTimer = setInterval(() => {
        secondsLeft--;
        document.getElementById("timer").textContent = `Time left: ${Math.floor(secondsLeft / 60)}:${(secondsLeft % 60).toString().padStart(2, '0')}`;
        if (secondsLeft <= 0) {
            endQuestion(); // Call your function to end the question once time runs out
        }
    }, 1000);
}


function startQuestion() {
    if (questionsAsked >= questionsPerRound) {
        endTriviaRound();
        return;
    }
    nextQuestion();
}



//function to update the time remaining before the next question
function startCountdown() {
	let countdown = timebetweenQuestions;
	nextquestionTimer(countdown);
	countdownTimer = setInterval(() => {
		countdown--;
		nextquestionTimer(countdown);
		if (countdown <= 0) {
			clearInterval(countdownTimer);
			startQuestion();
		}
	}, 1000);
}

//update the guestion counter (how many questions have been asked out of the total questions in the round)
function updateQuestionCounter() {
	document.getElementById("question-counter").textContent = `Question: ${questionsAsked} / ${questionsPerRound}`;
}

function endQuestion() {
    clearInterval(questionTimer);
    document.getElementById("question").textContent = "Time's up! Answer was: " + activeQuestion.answer;
	
    hideQuestionTimer = setTimeout(() => {
        document.getElementById("questionWrapper").style.visibility = "hidden";
        document.getElementById("triviaboard").style.visibility = "visible";
        
        // Check if we've asked the maximum number of questions for the round
        if (questionsAsked >= questionsPerRound) {
            // End the trivia round if we've reached the limit
            endTriviaRound();
            return;
        } else {
            // Otherwise, start the countdown for the next question
            startCountdown();
        }
    }, 13000); // Delay timeout of 13 seconds to wait before checking
}

//function to update the countdown until next question
function nextquestionTimer(seconds) {
	const minutes = Math.floor(seconds / 60);
	const remainingSeconds = seconds % 60;
	document.getElementById("timeuntil-nextQ").textContent = `Next question in: ${minutes}m ${remainingSeconds}s`;
}

function checkAnswer(user, message) {
    // Check if there's an active question and if the user has already answered correctly
    if (!activeQuestion || answeredUsers.has(user)) return;  // If the user has already answered correctly, don't process further answers

    let correctAnswer = activeQuestion.answer.toLowerCase();
    let userAnswer = message.trim().toLowerCase();

    // Initialize user stats if they don't exist
    if (!userStats[user]) {
        userStats[user] = {
            correctAnswers: 0,
            incorrectAnswers: 0,
            firstAnswers: 0,
        };
    }

    // Track if the answer is correct or incorrect
    if (userAnswer === correctAnswer) {
        // Correct answer logic
        userStats[user].correctAnswers++;  // Increment correct count only if correct answer
        answeredUsers.add(user);  // Mark the user as having answered correctly
        
        // Track first correct answer
        if (!firstAnswerUser) {
            firstAnswerUser = user;
            userStats[user].firstAnswers++;
            userScores[user] = (userScores[user] || 0) + 3;  // First answer gets 3 points
        } else {
            userScores[user] = (userScores[user] || 0) + 1;  // Others get 1 point
        }

        updateTriviaboard();  // Update the trivia board with new stats
        return true;  // Return true for correct answers
    } else {
        // Incorrect answer logic
        userStats[user].incorrectAnswers++;  // Increment incorrect count only if incorrect answer
        return false;  // Return false for incorrect answers
    }
}
function oldcheckAnswer(user, message) {
    if (!activeQuestion || answeredUsers.has(user)) return;
    let correctAnswer = activeQuestion.answer.toLowerCase();
    let userAnswer = message.trim().toLowerCase();
    if (userAnswer === correctAnswer) {
        // Track correct answers
        if (!userStats[user]) {
            userStats[user] = {
                correctAnswers: 0,
                firstAnswers: 0
            };
        }
        userStats[user].correctAnswers++; // Increment correct answers count

        // Track if the user answered first
        if (!firstAnswerUser) {
            firstAnswerUser = user;
            userStats[user].firstAnswers++; // Increment first answers count
            userScores[user] = (userScores[user] || 0) + 3; // Add 3 points for first correct answer
        } else {
            userScores[user] = (userScores[user] || 0) + 1; // Add 1 point for a correct answer after the first
        }
        updateTriviaboard();
    }
}

function updateTriviaboard() {
    const triviaboardElement = document.getElementById("triviaboard");
    triviaboardElement.innerHTML = "<p>Trivia</p>";

    Object.entries(userScores)
        .sort((a, b) => b[1] - a[1]) // Sort by score
        .forEach(([user, score]) => {
            const li = document.createElement("li");
            const correctAnswers = userStats[user] ? userStats[user].correctAnswers : 0;
			const incorrectAnswers = userStats[user] ? userStats[user].incorrectAnswers : 0;
            const firstAnswers = userStats[user] ? userStats[user].firstAnswers : 0;
            li.textContent = `${user}: ${score} pts |🎯 ${firstAnswers} |✅ ${correctAnswers} |❌ ${incorrectAnswers}`;
            triviaboardElement.appendChild(li);
        });
}

//function to show the trivia overlay/ui display
function showTrivia() {
	const triviaWrapper = document.getElementById("TriviaWrapper");
    const questionWrapper = document.getElementById("questionWrapper");
    const board = document.getElementById("triviaboard");
    const timer = document.getElementById("timer");
    const timeUntilNextQ = document.getElementById("timeuntil-nextQ");

    // Show elements with animations
	triviaWrapper.style.visibility = "visible";
	triviaWrapper.style.opacity = "1";
    questionWrapper.style.visibility = "visible";
    questionWrapper.style.opacity = "1";
    questionWrapper.style.animation = "fadeIn 0.8s ease-out forwards";

    board.style.animation = "slideIn 0.8s ease-out forwards";
    timer.style.animation = "fadeIn 1s ease-in-out forwards";
    timeUntilNextQ.style.animation = "fadeIn 1s ease-in-out forwards";
}
//function to hide the trivia overlay/ui display
function hideTrivia() {
	const triviaWrapper = document.getElementById("TriviaWrapper");
    const questionWrapper = document.getElementById("questionWrapper");
    const board = document.getElementById("triviaboard");
    const timer = document.getElementById("timer");
    const timeUntilNextQ = document.getElementById("timeuntil-nextQ");

    // Hide elements with animations
    questionWrapper.style.animation = "fadeOut 0.5s ease-in forwards";
    board.style.animation = "slideOut 0.5s ease-in forwards";
    timer.style.animation = "fadeOut 0.5s ease-in forwards";
    timeUntilNextQ.style.animation = "fadeOut 0.5s ease-in forwards";

    setTimeout(() => {
        questionwrapper.style.visibility = "hidden";
        questionwrapper.style.opacity = "0";
		triviaWrapper.style.visibility = "hidden";
		triviaWrapper.style.opacity = "0";
    }, 500); // Matches the fade-out animation duration
}
//function to toggle trivia overlay/ui display
function toggleTrivia() {
    const wrapper = document.getElementById("questionWrapper");
    const board = document.getElementById("triviaboard");
    const timer = document.getElementById("timer");
    const timeUntilNextQ = document.getElementById("timeuntil-nextQ");

    if (wrapper.style.visibility === "hidden" || wrapper.style.visibility === "") {
        // Show elements with animations
        wrapper.style.visibility = "visible";
        wrapper.style.opacity = "1";
        wrapper.style.animation = "fadeIn 0.8s ease-out forwards";

        board.style.animation = "slideIn 0.8s ease-out forwards";
        timer.style.animation = "fadeIn 1s ease-in-out forwards";
        timeUntilNextQ.style.animation = "fadeIn 1s ease-in-out forwards";
    } else {
        // Hide elements with animations
        wrapper.style.animation = "fadeOut 0.5s ease-in forwards";
        board.style.animation = "slideOut 0.5s ease-in forwards";
        timer.style.animation = "fadeOut 0.5s ease-in forwards";
        timeUntilNextQ.style.animation = "fadeOut 0.5s ease-in forwards";

        setTimeout(() => {
            wrapper.style.visibility = "hidden";
            wrapper.style.opacity = "0";
        }, 500); // Matches the fade-out animation duration
    }
}

// Function to start trivia and run the triviasplash animation
function startTrivia() {
    if (triviaGameState === "started") {
        console.log("Trivia is already running! Ignoring duplicate command.");
        return; // Stop if trivia is already running
    }
    console.log("Trivia should splash and fetch questions");
    triviaGameState = "started"; // Mark trivia as started
	console.log("triviaGameState = " + triviaGameState);
    triviaSplash() // Run splash first
        .then(() => fetchTriviaQuestions()) // Fetch questions after splash
        .then(questions => {
            console.log("Trivia Questions Loaded:", questions);
            window.triviaQuestions = questions;
            startQuestion(); // Start the trivia after fetching
        })
        .catch(error => {
            console.error("Error loading trivia questions:", error);
            triviaGameState = null; // Reset state on failure
        });
}


//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
function updateUserOverallStats() {
    const sortedUsers = Object.entries(userScores).sort((a, b) => b[1] - a[1]);

    sortedUsers.forEach(([user, score]) => {
        if (!userOverallStats[user]) {
            userOverallStats[user] = {
                correctAnswers: 0,
                firstAnswers: 0,
				incorrectAnswers: 0,
                round1wins: 0,
                round2wins: 0,
                round3wins: 0,
                // Add more rounds as needed
            };
        }

        // Accumulate stats
        userOverallStats[user].correctAnswers += userStats[user]?.correctAnswers || 0;
        userOverallStats[user].firstAnswers += userStats[user]?.firstAnswers || 0;
		userOverallStats[user].incorrectAnswers += userStats[user]?.incorrectAnswers || 0;
    });

    // Award round win to the top scorer
    if (sortedUsers.length > 0) {
        let topUser = sortedUsers[0][0]; // Get username of the top scorer
        let roundKey = `round${round}wins`;

        if (!userOverallStats[topUser][roundKey]) {
            userOverallStats[topUser][roundKey] = 0;
        }
        userOverallStats[topUser][roundKey]++; // Increment their round wins
    }

    console.log("Updated Overall Stats:", userOverallStats); // Debug log
}

//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
function endTriviaRound() {
    document.getElementById("question").textContent = `Round ${round} Over!`;
    clearInterval(questionTimer);
    toggleElement("questionWrapper", "fade");
    document.getElementById("timer").textContent = "";
    document.getElementById("timeuntil-nextQ").textContent = "";

    // Store round stats in overall stats
    updateUserOverallStats();

    // Announce winners
    announceWinners();

    // Prepare for the next round
    round++;
    userStats = {}; // Reset stats for the new round
}

let userColors = {}; // Store user colors

function announceWinners() {
    // Get top 5 sorted users
    const sortedUsers = Object.entries(userScores).sort((a, b) => b[1] - a[1]);

    console.log("Sorted users:", sortedUsers);

    for (let i = 0; i < 3; i++) {
        const [user, score] = sortedUsers[i] || [];
        if (user) {
            console.log(`Winner ${i + 1}: ${user} - Score: ${score}`);
            displayChatMessage("Console:", `Winner ${i + 1}: ${user} - Score: ${score}`, {}, {});

            let nameElement = document.getElementById(`winner${i + 1}Name`);
            let scoreElement = document.getElementById(`winner${i + 1}Score`);

            nameElement.textContent = user;
            scoreElement.textContent = `Score: ${score}`;

            // Apply user color
            let userColor = userColors[user] || "#FFFFFF"; // Default white
            nameElement.style.color = userColor;

            // Parent container
            const winnerContainer = document.getElementById(`winner${i + 1}`).parentElement;

            // Remove any existing extra stats div to prevent duplicates
            let oldExtraStats = winnerContainer.querySelector(".extraStats");
            if (oldExtraStats) oldExtraStats.remove();

            // Create extra stats div
            let extraStatsDiv = document.createElement("div");
            extraStatsDiv.className = "extraStats";

            // Create and set stats elements
            let firstAnswersElement = document.createElement("p");
            let correctAnswersElement = document.createElement("p");
            let incorrectAnswersElement = document.createElement("p");

            let firstAnswers = userStats[user]?.firstAnswers || 0;
            let correctAnswers = userStats[user]?.correctAnswers || 0;
            let incorrectAnswers = userStats[user]?.incorrectAnswers || 0;

            firstAnswersElement.textContent = `🎯 First: ${firstAnswers}`;
            correctAnswersElement.textContent = `✅ Correct: ${correctAnswers}`;
            incorrectAnswersElement.textContent = `❌ Incorrect: ${incorrectAnswers}`;

            extraStatsDiv.appendChild(incorrectAnswersElement);
            extraStatsDiv.appendChild(correctAnswersElement);
            extraStatsDiv.appendChild(firstAnswersElement);

            // Append the extraStatsDiv next to the winner container
            winnerContainer.appendChild(extraStatsDiv);
        }
    }

    // Update 4th and 5th place winners
    for (let i = 3; i < 5; i++) {
        const [user, score] = sortedUsers[i] || [];
        if (user) {
            console.log(`Winner ${i + 1} (4th/5th place): ${user} - Score: ${score}`);

            let nameElement = document.getElementById(`winner${i + 1}Name`);
            let scoreElement = document.getElementById(`winner${i + 1}Score`);

            nameElement.textContent = user;
            scoreElement.textContent = `Score: ${score}`;

            let userColor = userColors[user] || "orangered"; // Default color
            nameElement.style.color = userColor;
        }
    }

    // Show podium
    const triviaPodium = document.getElementById("triviaPodium");
    if (triviaPodium) {
        console.log("Displaying triviaPodium...");
        displayChatMessage("Console:", "Displaying triviaPodium...", {}, {});
        triviaPodium.style.display = "flex";
    } else {
        console.log("Error: triviaPodium element not found!");
        displayChatMessage("Console:", "Error: triviaPodium element not found!", {}, {});
    }
}



function endTrivia() {
    clearInterval(questionTimer);
    clearInterval(countdownTimer);
    clearTimeout(hideQuestionTimer);

    triviaGameState = null;
    questionsAsked = 0;
    round = 1;
    usedQuestions = [];
    userScores = {};
    answeredUsers.clear();
    firstAnswerUser = null;

    // Hide UI elements or reset text
    document.getElementById("timeuntil-nextQ").textContent = "";

    hideTrivia(); // Hide the trivia UI
}

//-end of trivia game----------
//____________________________|


//-----------------------
//---generic ui logic---|

//function to toggle element visibility
function toggleElement(elementId, animationType = "fade") {
    const element = document.getElementById(elementId);

    if (!element) return;

    if (element.style.visibility === "hidden" || element.style.visibility === "") {
        // Show element with animation
        element.style.visibility = "visible";
        element.style.opacity = "1";
        element.style.animation = animationType === "slide" ? "slideIn 0.8s ease-out forwards" : "fadeIn 0.8s ease-out forwards";
    } else {
        // Hide element with animation
        element.style.animation = animationType === "slide" ? "slideOut 0.5s ease-in forwards" : "fadeOut 0.5s ease-in forwards";

        setTimeout(() => {
            element.style.visibility = "hidden";
            element.style.opacity = "0";
        }, 500); // Matches animation duration
    }
}


//---AUDIO LOGIC-----------------|
// Preload sounds and store them in an object
const sounds = {
    snakedie: new Audio("/assets/sounds/snakedie_sound1.mp3"),
    gameshowintro: new Audio("/assets/sounds/gameshow_intro.mp3"),
	triviaRoundfin: new Audio("/assets/sounds/gameshow_intro.mp3"),
	triviauserbuzz: new Audio("/assets/sounds/gameshow_intro.mp3"),
	triviacorrectding: new Audio("/assets/sounds/gameshow_intro.mp3"),
    // Add more sounds here
};

// Ensure all sounds are loaded and muted initially
for (const sound in sounds) {
    sounds[sound].muted = true;
    sounds[sound].load();
}
// Generic function to play any sound
function playSound(name) {
    if (sounds[name]) {
        sounds[name].muted = false; // Unmute the sound
        sounds[name].currentTime = 0; // Reset sound to start
        sounds[name].play().catch(error => {
            console.error(`Error playing ${name}:`, error);
        });
    } else {
        console.error(`Sound '${name}' not found.`);
    }
}

//comfy js specific logic/functions
// ComfyJS onChat event handler

<!-- ComfyJS.onChat = (user, message, color, flags, extra) => { -->
    <!-- console.log( "UserColor:", extra.userColor, "User:", user, "Message:", message); -->
    <!-- // Call the displayChatMessage function and pass flags and extra for userColor and badges -->
    <!-- displayChatMessage(user, message, flags, extra);  // Show message in chat box -->
    <!-- checkAnswer(user, message);         // Check if it's an answer -->
<!-- }; -->



ComfyJS.onChat = (user, message, color, flags, extra) => {
    // If chat answers are enabled, check the message for answers
    if (chatanswers) {
        console.log("UserColor:", extra.userColor, "User:", user, "Message:", message);
        // Check if the message is correct
        let isCorrect = checkAnswer(user, message);
        // Display the message with whether it's correct or not
        displayChatMessage(user, message, flags, extra, isCorrect);
    } else {
        // Otherwise, just display the message without checking
        displayChatMessage(user, message, flags, extra, false);
    }
};


ComfyJS.onCommand = (user, command, message, flags, extra) => {
    // Store user color from extra
    if (!userColors[user]) {
        userColors[user] = extra.userColor || "#FFFFFF"; // Default to white if no color is provided
    }

    // Only allow streamer (jaedraze) or mods to trigger these commands
    if (user.toLowerCase() === streamername || flags.mod) {
		console.log( "User:", user, "command:", command);
		if (command.toLowerCase() === "testsound-1") {
				playSound(); // Play the sound when !playsound is typed in chat
			}
        if (command === "chatanswers") {
            chatanswers = !chatanswers;  // Toggle chatanswers
            // Show in the chat whether chat answers are now enabled or disabled
            displayChatMessage(user, `Chat answers are now ${chatanswers ? "enabled" : "disabled"}.`, flags, extra, false);
        }
        // Handle start trivia command
        if (command.toLowerCase() === "testtriviasplash") {
            triviaSplash(); // Call the startTrivia function
        }
		if (command === "triviaset" && params[0] === "answertime" && params.length === 2) {
			let newTime = parseInt(params[1]); // The time will be the second parameter

			if (!isNaN(newTime) && newTime > 0) {
				timetoAnswer = newTime;
				console.log(`Time to answer is now set to ${newTime} seconds!`);
				displayChatMessage("System:", `Time to answer is now set to ${newTime} seconds!`);
			} else {
				console.log("Invalid time. Please provide a positive number.");
				displayChatMessage("System:", "Invalid time. Please provide a positive number.");
			}
		}
		// Check if the command is 'triviaset' and the second part is 'questionsperround'
		if (command === "triviaset" && params[0] === "questionsperround" && params.length === 2) {
			let newQuestionsPerRound = parseInt(params[1]);

			if (!isNaN(newQuestionsPerRound) && newQuestionsPerRound > 0) {
				questionsPerRound = newQuestionsPerRound;
				console.log(`Questions per round is now set to ${newQuestionsPerRound}!`);
				displayChatMessage("System:", `Questions per round is now set to ${newQuestionsPerRound}!`, {}, {});
			} else {
				console.log("Invalid number of questions. Please provide a positive number.");
				displayChatMessage("System:", "Invalid number of questions. Please provide a positive number.", {}, {});
			}
		}
        // Handle start trivia command
        if (command.toLowerCase() === "trivia") {
            startTrivia();
        }
		if (command === "togglechat") {
			toggleElement("twitchchatContainer", "fade");
		}
		if (command === "toggletriviaboard") {
			toggleElement("triviaboard", "slide");
		}
		if (command === "togglequestions") {
			toggleElement("questionWrapper", "fade");
		}
        // Handle toggle trivia visibility command
        if (command.toLowerCase() === "toggletrivia") {
			toggleTrivia();
            toggleElement("triviaWrapper", "fade");
        }
        // Handle trivia round 2 command
        if (command.toLowerCase() === "triviaround2") {
            if (round === 1) {
                round = 2;
                questionsAsked = 0; // Reset for the new round
                document.getElementById("question").textContent = "Trivia Round 2 Begins!";
                setTimeout(startQuestion, 3000);
            }
        }
        // Handle toggle chat visibility command
        if (command.toLowerCase() === "togglechat") {
            let chatContainer = document.getElementById("twitchchatContainer");
            if (chatContainer.style.visibility === "hidden") {
                chatContainer.style.visibility = "visible"; // Show the chat if it's hidden
            } else {
                chatContainer.style.visibility = "hidden"; // Hide the chat if it's visible
            }
        }
        // Example commands that any user can trigger
        if (command === "a" || command === "answer") {
            let answer = message.trim();  // Extract the answer
            let isCorrect = checkAnswer(user, answer);  // Check if the answer is correct

            // Display the answer in chat regardless of whether it's correct or incorrect
            if (isCorrect) {
                // If the answer is correct, display the answer with a ✅ checkmark
                displayChatMessage(user, `!${command} ${answer} ✅`, flags, extra, true);  // Show correct answer in chat
            } else if (!answeredUsers.has(user)) {
                // If the user hasn't answered correctly yet, display the answer with an ❌ X mark
                displayChatMessage(user, `!${command} ${answer} ❌`, flags, extra, false);  // Show incorrect answer in chat
            } else {
                // If the user has already answered correctly, do nothing (ignore their further answers)
                console.log(`${user} has already answered correctly. Ignoring further answers.`);
            }
        }
    } else {

        if (command.toLowerCase() === "helloworld") {
            // Custom logic to send "Hello, world!" to your overlay chat
            const message = "Hello, world!";
            displayChatMessage("System", message, {}, {}); // Call the function to display the message in the chat overlay
            console.log(`Sent message to overlay: ${message}`); // Log to the console
        }

        if (command.toLowerCase() === "joke") {
            const jokes = [
                "Why don't skeletons fight each other? They don't have the guts!",
                "Why did the scarecrow win an award? Because he was outstanding in his field!",
                "I told my computer I needed a break, and now it won’t stop sending me Kit-Kats!"
            ];
            const randomJoke = jokes[Math.floor(Math.random() * jokes.length)];
            displayChatMessage("System", randomJoke, {}, {}); // Sends a random joke to the overlay chat
            console.log(`Sent joke to overlay: ${randomJoke}`); // Log the joke sent to the console
        }
    }
};



//window on load stuffs
<!-- window.onload = () => { -->
    <!-- document.getElementById("interactButt").click(); -->
	<!-- console.log('enableAudio button clicked on windowload'); -->
<!-- }; -->

<!-- fetchTriviaQuestions(); -->//function to fetch questions on load

let streamername = "jaedraze"; // Default streamer name


function setStreamer(newStreamer) {
    const twitchdisconnectbutton = document.getElementById("twitchdisconnectButt");
    const button = document.getElementById("streamersButt"); 
    const input = document.querySelector("#triviacontrolContainer input[type='text']");

    if (newStreamer && newStreamer.trim() !== "") {
        streamername = newStreamer.trim();
        localStorage.setItem("lastStreamer", streamername); // Save to localStorage
        ComfyJS.Init(streamername);
        console.log(`Connected to Twitch chat for: ${streamername}`);

        // Update button styles
        button.style.display = "none";
        button.style.backgroundColor = "#28a745"; 
        button.style.color = "#0e5b75"; 
        button.style.border = "1px solid #28a745"; 

        twitchdisconnectbutton.style.display = "block"; 
        twitchdisconnectbutton.style.backgroundColor = "#dc3545"; 
        twitchdisconnectbutton.style.color = "#ffffff"; 
        twitchdisconnectbutton.style.border = "1px solid #dc3545"; 

        // Green outline for valid input
        input.style.outline = "3px outset #28a745"; 
    } else {
        console.log("Please enter a valid streamer name.");
        disconnectBot(); // Ensure disconnection
        localStorage.removeItem("lastStreamer"); // Remove stored streamer name

        // Update UI for disconnection
        twitchdisconnectbutton.style.display = "none"; 
        button.textContent = "id10t err: try diff name";
        button.style.backgroundColor = "#dc3545"; 
        button.style.color = "#ffffff"; 
        button.style.border = "1px solid #dc3545"; 

        // Red outline for invalid input
        input.style.outline = "3px outset #dc3545"; 
    }
}

// Auto-reconnect on page load
window.onload = function () {
    const savedStreamer = localStorage.getItem("lastStreamer");
    if (savedStreamer) {
        setStreamer(savedStreamer); // Auto-connect
    }
};

function disconnectBot() {
	const button = document.getElementById("streamersButt");
	button.display = "";
    ComfyJS.Disconnect();
	
    console.log("Bot disconnected from Twitch.");

    // Remove stored streamer name from localStorage
    if (localStorage.getItem("lastStreamer")) {
        localStorage.removeItem("lastStreamer");
        console.log("Removed last connected streamer from storage.");
    }

    // Update UI after disconnecting
    const twitchdisconnectbutton = document.getElementById("twitchdisconnectButt");
    const input = document.querySelector("#triviacontrolContainer input[type='text']");

    twitchdisconnectbutton.style.display = "none"; 
    button.textContent = "Connect";
    button.style.backgroundColor = "#dc3545"; 
    button.style.color = "#ffffff"; 
    button.style.border = "1px solid #dc3545"; 
    input.style.outline = "3px outset #dc3545"; 
}


// Button event listener: first endTrivia, then setStreamer
document.getElementById("streamersButt").addEventListener("click", function() {
    if (triviaGameState === "started") {
		console.log("Ending Trivia.");
        endTrivia(); // Only end trivia if it's running
    }
    let newStreamer = document.querySelector("input[name='yourTextName']").value;
	console.log("attempting to Connect to:" + newStreamer);
    setStreamer(newStreamer); // Then, set the new streamer
});
// Button event listener: first endTrivia, then setStreamer
document.getElementById("startGame").addEventListener("click", function() {
    if (triviaGameState === null) {
		startTrivia(); // Only start trivia if it's not running 
    }
});
// Button event listener: canceL AND reset game
document.getElementById("cancelGame").addEventListener("click", function() {
    if (triviaGameState === "started") {
        endTrivia(); // Only end trivia if it's running
    }
});

</script>
</body>
</html>


