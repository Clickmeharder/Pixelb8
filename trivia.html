<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trivia v2.11</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            color: orangered;
            text-align: center;
            margin: 0;
            padding: 0;
			width: 100vw;
			height: 100vh;
        }
        #question {
			position: absolute;
			font-weight: bold;
			top: 20px;
			right: 8px;
			width: 65%;
			max-width: 700px;
			text-align: center;
			padding: 15px 20px;
			background: linear-gradient(135deg, #001f1f, #004040);
			border: 3px solid teal;
			border-radius: 12px;
			color: white;
			text-shadow: 2px 2px 4px rgba(0, 255, 255, 0.5);
			box-shadow: 0px 0px 12px rgba(0, 255, 255, 0.5);
			transition: transform 0.2s ease-in-out;
		}

		#question:hover {
			transform: scale(1.05); /* Slight hover effect for interactivity */
		}
        #leaderboard {
			position: absolute;
			top: 9%;
			font-size: 15px;
			right: 14px;
		}
		#leaderboard p {
			background: #001f1f;
			width: 155px;
			padding: 4px;
			margin: 0px;
			font-size: 18px;
			border: 2px outset #095656;
			border-radius: 0px;
		}
        #leaderboard li {
            margin: -6px 0 0px 0;
			text-align: center;
			padding: 4px 9px;
			width: ;
			max-width: ;
			background: linear-gradient(135deg, #001f1f, #004040);
			border: 3px solid teal;
			border-radius: 12px;
			color: #12ebeb;
			text-shadow: 1px 1px 4px rgb(0 255 239 / 65%);
			box-shadow: 0px 0px 12px rgb(0 255 239 / 65%);
			transition: transform 0.2s ease-in-out;
        }
		#correct-answer {
			position: absolute;
			top: 0px;
			right: 0px;
			font-size: 18px;
			padding: 6px;
			width: 261px;
			background: #004040f2;
			border-radius: 18px;
			color: #8d7c7f;
			z-index: 100;
		}
    </style>
</head>
<body>
    <div id="question">-</div>
	<div id="next-question-timer"></div>
    <div id="timer">30</div>
    <div id="correct-answer"></div>
    <ul id="leaderboard">
        <p>Leaderboard</p>
        <li>...</li>
    </ul>

    <script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.js"></script>
<script>
	const triviaQuestions = [
		{ question: "converting 100 shrapnel results in how much universal ammo?", answer: "101" },
		{ question: "What number is on the side of a Sleipnir mk1 (C,L)?", answer: "88" },
		{ question: "What is 5 + 3?", answer: "8" },
		{ question: "Who painted the Mona Lisa?", answer: "da vinci" },
		{ question: "what is the smallest Skildek support weapon?", answer: "lancehead" },
		{ question: "what amp drops from bots found at orthos oilfield", answer: "b101" },
		{ question: "what does CDF stand for", answer: "calypso defense force" },
		{ question: "what does IFN stand for", answer: "imperial federal navy" },
		{ question: "what is Jaedraze's avatars first name", answer: "Jimmy" },
		{ question: "what is Jaedraze's avatars middle name", answer: "Jimbobbityboo" },
		{ question: "what year is it?", answer: "2025" },
		{ question: "what items are used to craft explosive projectiles?", answer: "nanocubes" },
		{ question: "what is the name of the starting zone on calypso", answer: "thule" },
		{ question: "how many paint cans or textures for max success?", answer: "323" },
		{ question: "how many ped is 100pec worth?", answer: "1" },
		{ question: "how many pec is 1ped worth?", answer: "100" },
		{ question: "how many pec is 10ped worth?", answer: "1000" },
		{ question: "if the questions answer is the fourth word of the question. what is the answer?", answer: "answer" },
	];

	let userScores = {}; 
	let currentQuestionIndex = 0;
	let questionActive = false; 
	let timer;
	let answerTime = 120; // 2 minutes
	let timeBetweenQuestions = 180; // 3 minutes
	let firstAnswerGiven = false;
	let firstAnswerUser = null;

	// Get a random question index
	function getRandomQuestionIndex() {
		return Math.floor(Math.random() * triviaQuestions.length);
	}

	// Update and show a new question
	function updateQuestionDisplay() {
		currentQuestionIndex = getRandomQuestionIndex();
		document.getElementById("question").textContent = triviaQuestions[currentQuestionIndex].question;
		document.getElementById("question").style.border = "3px solid teal";
		document.getElementById("question").style.color = "white";
		document.getElementById("correct-answer").textContent = "";
		questionActive = true;
		firstAnswerGiven = false;
		firstAnswerUser = null;
		startTimer();
	}

	// Proceed to the next question
	function nextQuestion() {
		updateQuestionDisplay();
	}

	// Start countdown timer
	function startTimer() {
		clearInterval(timer);
		answerTime = 120;
		timer = setInterval(() => {
			answerTime--;
			document.getElementById("timer").textContent = answerTime;
			if (answerTime <= 0) {
				clearInterval(timer);
				document.getElementById("correct-answer").textContent = `Time's up! Answer: ${triviaQuestions[currentQuestionIndex].answer}`;
				questionActive = false;
				startNextQuestionTimer();
			}
		}, 1000);
	}

	// Start a timer for the next question
	function startNextQuestionTimer() {
		setTimeout(nextQuestion, timeBetweenQuestions * 1000);
	}

	// Check user answers
	function checkAnswer(user, message) {
		if (!questionActive) return;

		let correctAnswer = triviaQuestions[currentQuestionIndex].answer.toLowerCase();
		let userAnswer = message.trim().toLowerCase();

		if (userAnswer === correctAnswer) {
			handleCorrectAnswer(user);
		}
	}

	// Handle a correct answer
	function handleCorrectAnswer(user) {
		clearInterval(timer);
		document.getElementById("question").style.border = "3px solid green";
		document.getElementById("question").style.color = "lightgreen";
		document.getElementById("correct-answer").textContent = `${user} got it right! Answer: ${triviaQuestions[currentQuestionIndex].answer}.`;

		if (!firstAnswerGiven) {
			userScores[user] = (userScores[user] || 0) + 3;
			firstAnswerGiven = true;
			firstAnswerUser = user;
			answerTime = 120;
		} else if (user !== firstAnswerUser) {
			userScores[user] = (userScores[user] || 0) + 1;
		}

		updateLeaderboard();
		startNextQuestionTimer();
	}

	// Update leaderboard
	function updateLeaderboard() {
		const leaderboardElement = document.getElementById("leaderboard");
		leaderboardElement.innerHTML = "<p>Leaderboard</p>";
		Object.entries(userScores)
			.sort((a, b) => b[1] - a[1])
			.forEach(([user, score]) => {
				const li = document.createElement("li");
				li.textContent = `${user}: ${score} pts`;
				leaderboardElement.appendChild(li);
			});
	}

	// Listen for Twitch chat commands
	ComfyJS.onCommand = (user, command, message, flags, extra) => {
		if (command.toLowerCase() === "playtrivia") {
			updateQuestionDisplay();
		}
	};

	// Listen for user messages to check answers
	ComfyJS.onChat = (user, message) => {
		checkAnswer(user, message);
	};

	// Connect to Twitch chat
	ComfyJS.Init("jaedraze");
	// Start the first trivia question
	updateQuestionDisplay();
</script>

</body>
</html>
