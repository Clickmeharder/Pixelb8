<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trivia v3.00</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            color: orangered;
            text-align: center;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
        }
		#questionWrapper {
			position: absolute;
			top: 71%;
			left: 2px;
			width: 25%;
			max-width: 25%;
			text-align: center;
			padding: 15px 20px;
			background: linear-gradient(135deg, #001f1f, #004040);
			border: 3px solid teal;
			border-radius: 12px;
			box-shadow: 0px 0px 12px rgba(0, 255, 255, 0.5);
		}
        #question {
            font-weight: bold;
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 255, 255, 0.5);
        }
		
		p#question-counter {
			margin: 0;
		}
		#triviaboard {
			position: absolute;
			top: 0%;
			font-size: 15px;
			right: 0;
			margin:0;
		}
        #triviaboard p {
            background: #001f1f;
            width: 155px;
            padding: 4px;
            margin: 0px;
            font-size: 18px;
            border: 2px outset #095656;
            border-radius: 0px;
        }
        #triviaboard li {
            margin: -6px 0 0px 0;
            text-align: center;
            padding: 4px 9px;
            background: linear-gradient(135deg, #001f1f, #004040);
            border: 3px solid teal;
            border-radius: 12px;
            color: #12ebeb;
            text-shadow: 1px 1px 4px rgb(0 255 239 / 65%);
            box-shadow: 0px 0px 12px rgb(0 255 239 / 65%);
        }
        #timer, #next-question-timer {font-size: 20px;font-weight: bold;color: lightblue;}
		div#next-question-timer {position: absolute;bottom: 25%;left: 2%;}
		
		#twitchchatContainer {position: absolute;left: 0;bottom: 30%;border: 1px solid orangered;width: 30%;}
		div#twitchMessagebox {text-align: left;border: 2px dotted #ff1b00;max-height: 170px;}
		#username {font-weight:bold;}
		.chatMessage {background-color: #000000c2;border: 1px dashed #696969;}
    </style>
</head>
<body>
	<div id="twitchchatContainer">
		<div id="twitchMessagebox">
		</div>
	</div>
	<div id="TriviaWrapper">
		<div id="next-question-timer"></div>
		<div id="questionWrapper">
			<p id="question-counter">Question: 0 / 12</p>
			<div id="question">Waiting for next question...</div>
			<div id="timer"></div>
		</div>
		<ul id="triviaboard">
			<p>Trivia</p>
		</ul>
	</div>
    <script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.js"></script>
    <script>

    </script>
    <script>
		
        <!-- const triviaQuestions = [ -->
            <!-- { question: "Converting 100 shrapnel results in how much universal ammo?", answer: "101" }, -->
            <!-- { question: "What number is on the side of a Sleipnir mk1 (C,L)?", answer: "88" }, -->
            <!-- { question: "What is 5 + 3?", answer: "8" }, -->
            <!-- { question: "Who painted the Mona Lisa?", answer: "da vinci" }, -->
            <!-- { question: "What is the smallest Skildek support weapon?", answer: "lancehead" }, -->
            <!-- { question: "What amp drops from bots found at Orthos Oilfield?", answer: "b101" }, -->
            <!-- { question: "What does CDF stand for?", answer: "calypso defense force" }, -->
            <!-- { question: "What does IFN stand for?", answer: "imperial federal navy" }, -->
            <!-- { question: "What is Jaedraze's avatar's first name?", answer: "Jimmy" }, -->
            <!-- { question: "What is Jaedraze's avatar's middle name?", answer: "Jimbobbityboo" }, -->
            <!-- { question: "What year is it?", answer: "2025" }, -->
            <!-- { question: "What items are used to craft explosive projectiles?", answer: "nanocubes" }, -->
            <!-- { question: "What is the name of the starting zone on Calypso?", answer: "thule" }, -->
            <!-- { question: "How many paint cans or textures for max success?", answer: "323" }, -->
            <!-- { question: "How many PED is 100 PEC worth?", answer: "1" }, -->
            <!-- { question: "How many PEC is 1 PED worth?", answer: "100" }, -->
            <!-- { question: "How many PEC is 10 PED worth?", answer: "1000" } -->
        <!-- ]; -->
//--------- TRIVIA -----------
//trivia game code starts here
        let userScores = {};
        let usedQuestions = [];
        let activeQuestion = null;
        let answeredUsers = new Set();
        let firstAnswerUser = null;
		let hideQuestionTimer;
        let questionTimer, countdownTimer;
		
		let round = 1;
		let questionsAsked = 0;
		const questionsPerRound = 12;
		let triviaQuestions = { round1: [], round2: [] };

		fetch("questions.json")
			.then(response => response.json())
			.then(data => {
				if (data && data.round1 && data.round1.length > 0) { 
					triviaQuestions = data;
					startQuestion();
				} else {
					console.error("Trivia questions not found or empty.");
				}
			})
			.catch(error => console.error("Error loading trivia questions:", error));
	
		function updateQuestionCounter() {
			document.getElementById("question-counter").textContent = `Question: ${questionsAsked} / ${questionsPerRound}`;
		}
		
		function getRandomQuestion() {
			let currentRound = round === 1 ? "round1" : "round2";
			let availableQuestions = triviaQuestions[currentRound].filter(q => !usedQuestions.includes(q));

			if (availableQuestions.length === 0) {
				usedQuestions = []; // Reset when all questions are used
				availableQuestions = [...triviaQuestions[currentRound]];
			}

			let question = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
			usedQuestions.push(question);
			return question;
		}

		function startQuestion() {
			if (questionsAsked >= questionsPerRound) {
				document.getElementById("question").textContent = `Trivia Round ${round} Over!`;
				clearInterval(questionTimer);
				document.getElementById("questionWrapper").style.visibility = "visible";
				return;
			}

			clearTimeout(countdownTimer);
			clearTimeout(hideQuestionTimer);
			activeQuestion = getRandomQuestion();
			answeredUsers.clear();
			firstAnswerUser = null;
			questionsAsked++;

			updateQuestionCounter(); // Update the display

			document.getElementById("question").textContent = activeQuestion.question;
			document.getElementById("questionWrapper").style.visibility = "visible";
			<!-- document.getElementById("triviaboard").style.visibility = "hidden"; -->
			document.getElementById("timer").textContent = "1:30";
			document.getElementById("next-question-timer").textContent = "";

			let secondsLeft = 90;
			questionTimer = setInterval(() => {
				secondsLeft--;
				document.getElementById("timer").textContent = `Time left: ${Math.floor(secondsLeft / 60)}:${(secondsLeft % 60).toString().padStart(2, '0')}`;
				if (secondsLeft <= 0) {
					endQuestion();
				}
			}, 1000);
		}

		function endQuestion() {
			clearInterval(questionTimer);
			document.getElementById("question").textContent = "Time's up! Answer was: " + activeQuestion.answer;

			setTimeout(() => {
				document.getElementById("question").textContent = "Next question starting soon...";
			}, 3000);

			hideQuestionTimer = setTimeout(() => {
				document.getElementById("questionWrapper").style.visibility = "hidden";
				document.getElementById("triviaboard").style.visibility = "visible";
			}, 10000);

			startCountdown();
		}

		function startCountdown() {
			let countdown = 150;
			updateCountdownDisplay(countdown);

			countdownTimer = setInterval(() => {
				countdown--;
				updateCountdownDisplay(countdown);
				if (countdown <= 0) {
					clearInterval(countdownTimer);
					startQuestion();
				}
			}, 1000);
		}

		function updateCountdownDisplay(seconds) {
			const minutes = Math.floor(seconds / 60);
			const remainingSeconds = seconds % 60;
			document.getElementById("next-question-timer").textContent = `Next question in: ${minutes}m ${remainingSeconds}s`;
		}

        function checkAnswer(user, message) {
            if (!activeQuestion || answeredUsers.has(user)) return;

            let correctAnswer = activeQuestion.answer.toLowerCase();
            let userAnswer = message.trim().toLowerCase();

            if (userAnswer === correctAnswer) {
                answeredUsers.add(user);
                if (!firstAnswerUser) {
                    firstAnswerUser = user;
                    userScores[user] = (userScores[user] || 0) + 3;
                } else {
                    userScores[user] = (userScores[user] || 0) + 1;
                }
                updateTriviaboard();
            }
        }

        function updateLeaderboard() {
            const triviaboardElement = document.getElementById("triviaboard");
            triviaboardElement.innerHTML = "<p>Trivia</p>";
            Object.entries(userScores)
                .sort((a, b) => b[1] - a[1])
                .forEach(([user, score]) => {
                    const li = document.createElement("li");
                    li.textContent = `${user}: ${score} pts`;
                    triviaboardElement.appendChild(li);
                });
        }
//-------------end of trivia game

//--------	Chat ---|
	function displayChatMessage(user, message) {
		const chatContainer = document.getElementById("twitchMessagebox");

		// Create a new chat message element
		const chatMessage = document.createElement("div");
		chatMessage.classList.add("chatMessage");

		// Create the username element and set its innerHTML directly
		const usernameSpan = document.createElement("span");
		usernameSpan.classList.add("username");
		usernameSpan.innerHTML = user + ":";

		// Create the message element and set its innerHTML directly
		const messageSpan = document.createElement("span");
		messageSpan.classList.add("twitchmessage");
		messageSpan.innerHTML = message;

		// Append the username and message spans to the chat message div
		chatMessage.appendChild(usernameSpan);
		chatMessage.appendChild(messageSpan);

		// Add the chat message to the container
		chatContainer.appendChild(chatMessage);

		// Remove older messages if there are more than 5
		while (chatContainer.children.length > 5) {
			chatContainer.removeChild(chatContainer.firstChild);
		}

		updateMessageStyles();
	}

	function updateMessageStyles() {
		const chatMessages = document.querySelectorAll(".chatMessage");
		const totalMessages = chatMessages.length;

		chatMessages.forEach((msg, index) => {
			// Change the opacity calculation so the oldest messages (top) fade more
			const opacity = (index + 1) / totalMessages; // Oldest = faded, Newest = full opacity
			//const bgBrightness = 15 + (index * 20); // Darkest = 15, Lighter as it gets older

			msg.style.opacity = opacity;
			//msg.style.backgroundColor = `rgb(${bgBrightness}, ${bgBrightness}, ${bgBrightness})`;
		});
	}

		ComfyJS.onCommand = (user, command, message, flags, extra) => {
			if (command.toLowerCase() === "triviaround2") {
				if (round === 1) {
					round = 2;
					questionsAsked = 0; // Reset for the new round
					document.getElementById("question").textContent = "Trivia Round 2 Begins!";
					setTimeout(startQuestion, 3000);
				}
			}
		};

		ComfyJS.onChat = (user, message) => {
			displayChatMessage(user, message);  // Show message in chat box
			checkAnswer(user, message);         // Check if it's an answer
		};
	
        ComfyJS.Init("jaedraze");

    </script>
</body>
</html>


