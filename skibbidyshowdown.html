<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skibbidy Showdown</title>
  <style>
    /* General Styling */
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      color: #fff;
      background: #121212;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    /* Title Styling */
    h1 {
      margin: 0;
      padding: 20px;
      text-align: center;
      font-size: 3rem;
      color: #ffcc00;
      text-shadow: 2px 2px 4px #000;
    }

    /* Instruction Container */
    .instructions {
      margin: 20px 0;
      padding: 10px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 10px;
      text-align: center;
      font-size: 1.2rem;
      max-width: 80%;
      color: #ccc;
      border: 1px solid #333;
    }

    /* Avatar Styling */
    .avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: white;
      overflow: hidden;
      border: 2px solid #ffcc00;
      transition: transform 0.2s ease;
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>
</head>
<body>

  <h1>Skibbidy Showdown</h1>
  <div class="instructions">
    Type commands in Twitch chat to interact: <strong>!move</strong>, <strong>!jump</strong>, or <strong>!skat</strong>!
  </div>

  <script src="https://cdn.jsdelivr.net/npm/comfy.js@1.0.0/dist/comfy.min.js"></script>
  <script>
    const avatars = {}; // Store active players
    const commands = ['!move', '!jump', '!skat']; // Available commands

    // Ensure ComfyJS is loaded before proceeding
    if (typeof ComfyJS === 'undefined') {
      console.error('ComfyJS is not defined. Ensure the script is loaded properly.');
    } else {
      // Function to sync avatars to the beat
      function syncToBeat(player, command) {
        const avatar = document.getElementById(player);
        if (avatar) {
          // Perform action based on command
          switch (command) {
            case '!move':
              avatar.style.transform = `translateX(${Math.random() * 100 - 50}px)`;
              break;
            case '!jump':
              avatar.style.transform = `translateY(-30px)`;
              setTimeout(() => (avatar.style.transform = 'translateY(0px)'), 200);
              break;
            case '!skat':
              avatar.style.backgroundColor = "#ff00ff";
              setTimeout(() => (avatar.style.backgroundColor = "white"), 500);
              break;
          }
        }
      }

      // Create a new avatar when a player joins
      async function addPlayer(user, profileImageURL) {
        if (!avatars[user]) {
          const avatar = document.createElement('div');
          avatar.id = user;
          avatar.classList.add('avatar');
          avatar.style.left = `${Math.random() * 90}%`;
          avatar.style.bottom = '10%';

          const img = document.createElement('img');
          img.src = profileImageURL || 'https://placekitten.com/50/50'; // Default image
          avatar.appendChild(img);

          document.body.appendChild(avatar);
          avatars[user] = true;
        }
      }

      // Initialize Comfy.js
      ComfyJS.Init("Jaedraze");

      // Handle chat messages
      ComfyJS.onCommand = (user, command, message, flags, extra) => {
        if (commands.includes(`!${command}`)) {
          if (!avatars[user]) {
            addPlayer(user, extra.userProfileImage);
          }
          syncToBeat(user, `!${command}`);
        }
      };
    }
  </script>

</body>
</html>
