<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ENTROPIA // VOICE_VOODOO_v9</title>
    <style>
        :root { --amber: #ffb300; --bg: #030303; --dim: #221a00; --red: #ff3333; }
        body { background: var(--bg); color: var(--amber); font-family: 'Consolas', 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        
        /* THE HUD FRAME */
        .hud-interface {
            width: 750px; border: 1px solid var(--amber); padding: 30px;
            background: radial-gradient(circle, rgba(255,179,0,0.05) 0%, rgba(0,0,0,1) 100%);
            box-shadow: 0 0 40px rgba(0,0,0,1), inset 0 0 20px var(--dim);
            position: relative;
        }

        .header { display: flex; justify-content: space-between; border-bottom: 2px solid var(--amber); padding-bottom: 10px; margin-bottom: 20px; font-weight: 900; letter-spacing: 2px; }
        
        /* PRO DROP-DOWN */
        .selector-box { background: #000; border: 1px solid var(--amber); position: relative; margin-bottom: 20px; }
        select { 
            width: 100%; background: transparent; color: var(--amber); border: none; padding: 15px; 
            font-size: 1.1em; cursor: pointer; outline: none; appearance: none;
        }
        select option { background: #080808; color: var(--amber); }

        /* TACTICAL GRID */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        button { 
            background: var(--dim); color: var(--amber); border: 1px solid var(--amber); 
            padding: 15px; font-weight: bold; cursor: pointer; text-transform: uppercase;
            transition: 0.1s;
        }
        button:hover { background: var(--amber); color: #000; box-shadow: 0 0 15px var(--amber); }

        /* REAL-TIME MATRIX LOG */
        .matrix-log { 
            margin-top: 25px; border-top: 1px dashed var(--amber); padding-top: 15px; 
            font-size: 0.75em; height: 150px; overflow-y: hidden; color: #886600;
        }
        .matrix-row { display: flex; justify-content: space-between; border-bottom: 1px solid #111; padding: 3px 0; }
        .val { color: #fff; }
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body>

<div class="hud-interface">
    <div class="header">
        <span>X-COMM // NEURAL_LINK</span>
        <span id="os-tag" class="blink">SCANNING...</span>
    </div>

    <div class="selector-box">
        <select id="voice-master" onchange="manualLock()">
            <option>AWAITING VOICE INJECTION...</option>
        </select>
    </div>

    <div class="grid">
        <button onclick="engage()">[ 1. ENGAGE UPLINK ]</button>
        <button onclick="executeMission()">[ 2. EXECUTE SIGNAL ]</button>
    </div>

    <div class="matrix-log" id="matrix">
        <div class="matrix-row"><span>METHOD:</span> <span class="val" id="m-method">FORCE_INDEX_RECON</span></div>
        <div class="matrix-row"><span>UPLINK_STRENGTH:</span> <span class="val" id="m-count">0</span></div>
        <div class="matrix-row"><span>PERSISTENCE_LOCK:</span> <span class="val" id="m-lock">OFF</span></div>
        <div class="matrix-row"><span>CLOUD_SYNC:</span> <span class="val" id="m-cloud">WAITING</span></div>
        <hr style="border: none; border-top: 1px solid var(--dim); margin: 10px 0;">
        <div id="status-stream">> CORE INITIALIZED. AWAITING USER INPUT...</div>
    </div>
</div>

<script>
    const synth = window.speechSynthesis;
    const voiceSelect = document.getElementById('voice-master');
    const stream = document.getElementById('status-stream');
    let lockedIndex = -1;

    // WEB VOODOO 1: The Multi-Pass Scanner
    function deepScan() {
        let voices = synth.getVoices();
        if (voices.length === 0) return;

        // Sort: Neural/Natural first, then Cloud, then Local
        voices.sort((a, b) => {
            const priority = (name) => (name.includes('Online') || name.includes('Natural') || name.includes('Aria')) ? 2 : (name.includes('Google') ? 1 : 0);
            return priority(b.name) - priority(a.name);
        });

        voiceSelect.innerHTML = '';
        voices.forEach((v, i) => {
            const opt = document.createElement('option');
            opt.value = i;
            const isNeural = (v.name.includes('Online') || v.name.includes('Natural')) ? '◆ NEURAL' : '◇ LOCAL';
            opt.textContent = `${isNeural} | ${v.name}`;
            voiceSelect.appendChild(opt);
        });

        document.getElementById('m-count').innerText = voices.length + " CHANNELS";
        document.getElementById('m-cloud').innerText = voices.some(v => v.name.includes('Online')) ? "SYNCED" : "OFFLINE";
        document.getElementById('os-tag').innerText = "SYSTEM READY";
        document.getElementById('os-tag').style.color = "#00ff00";
    }

    // WEB VOODOO 2: Anti-Reset Override
    function manualLock() {
        lockedIndex = voiceSelect.value;
        const voices = synth.getVoices();
        document.getElementById('m-lock').innerText = "LOCKED: " + voices[lockedIndex].name;
        pushStream(`LOCKING TO: ${voices[lockedIndex].name}`);
    }

    // WEB VOODOO 3: Buffer Clearing Logic
    function pushStream(msg) {
        stream.innerHTML = `> ${msg}<br>` + stream.innerHTML;
    }

    function engage() {
        // We speak a tiny silent character to 'pop' the browser's security bubble
        const pock = new SpeechSynthesisUtterance("Uplink Engaged");
        pock.volume = 0; 
        synth.speak(pock);
        deepScan();
        pushStream("NEURAL LINK ESTABLISHED.");
    }

    function executeMission() {
        const voices = synth.getVoices();
        const utter = new SpeechSynthesisUtterance("Mission complete. Sector clear. Return to base.");
        
        // FORCED SELECTION LOGIC: bypasses the "jumping" bug by re-assigning at the micro-second of execution
        const targetVoice = voices[voiceSelect.value];
        if (!targetVoice) {
            pushStream("ERROR: VOICE INDEX INVALID");
            return;
        }

        utter.voice = targetVoice;
        utter.rate = 0.95;
        utter.pitch = 1.0;

        // Safety: If the engine is currently talking, kill it to prevent queue-jumping
        if (synth.speaking) {
            pushStream("CLEARING BUFFER...");
            synth.cancel();
            setTimeout(() => synth.speak(utter), 100);
        } else {
            synth.speak(utter);
        }

        pushStream(`EXECUTING SIGNAL VIA [${targetVoice.name}]`);
    }

    // Initialize & Listen
    window.speechSynthesis.onvoiceschanged = deepScan;
    setInterval(deepScan, 2000); // Constant background scanning to catch late-loading Cloud voices
</script>

</body>
</html>