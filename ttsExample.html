<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ENTROPIA // COMMAND_CORE_v11</title>
    <style>
        :root { --a: #ffb300; --bg: #030303; --dim: #1a1500; --glow: rgba(255, 179, 0, 0.25); }
        body { background: var(--bg); color: var(--a); font-family: 'Consolas', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; text-transform: uppercase; }
        
        .hud-frame { 
            width: 550px; border: 1px solid var(--a); padding: 30px; 
            background: radial-gradient(circle at center, #0a0a0a 0%, #000 100%);
            box-shadow: 0 0 50px #000, inset 0 0 20px var(--dim);
        }

        .header { border-bottom: 2px solid var(--a); padding-bottom: 10px; margin-bottom: 20px; font-weight: 900; display: flex; justify-content: space-between; letter-spacing: 2px; }

        /* THE FUZZY SEARCH & CUSTOM INPUTS */
        .input-group { margin-bottom: 15px; position: relative; }
        label { font-size: 10px; display: block; margin-bottom: 5px; color: #860; }
        
        input[type="text"], textarea {
            width: 100%; background: #000; color: var(--a); border: 1px solid var(--a);
            padding: 12px; box-sizing: border-box; font-family: inherit; font-size: 13px;
            outline: none; box-shadow: inset 0 0 8px #000;
        }
        textarea { height: 80px; resize: none; border-color: #443300; }
        input:focus, textarea:focus { border-color: #fff; box-shadow: 0 0 10px var(--glow); }

        /* FUZZY DROPDOWN */
        .v-drop {
            position: absolute; width: 100%; max-height: 200px; overflow-y: auto;
            background: #080808; border: 1px solid var(--a); border-top: none;
            z-index: 100; display: none;
        }
        .v-drop.active { display: block; }
        .v-opt { padding: 8px 12px; border-bottom: 1px solid var(--dim); cursor: pointer; font-size: 11px; display: flex; justify-content: space-between; }
        .v-opt:hover { background: var(--a); color: #000; }

        .btn-fire { 
            width: 100%; background: var(--a); color: #000; border: none; 
            padding: 18px; cursor: pointer; font-weight: 900; font-size: 1.1em;
            margin-top: 10px; transition: 0.2s;
        }
        .btn-fire:hover { background: #fff; box-shadow: 0 0 20px #fff; }

        .matrix-debug { 
            margin-top: 20px; font-size: 10px; border-top: 1px dashed var(--a); 
            padding-top: 15px; color: #650; display: grid; grid-template-columns: 1fr 1fr;
        }
        .stat-val { color: #fff; text-shadow: 0 0 5px var(--a); }
        .blink { animation: b 1s infinite; }
        @keyframes b { 50% { opacity: 0.2; } }
    </style>
</head>
<body>

<div class="hud-frame">
    <div class="header">
        <span>[ BROADCAST_NODE_TX ]</span>
        <span class="blink" style="color:#0f0">LINK_LIVE</span>
    </div>

    <div class="input-group">
        <label>01 // SELECT NEURAL VOICE (TYPE TO FILTER)</label>
        <input type="text" id="v-search" autocomplete="off" placeholder="SEARCH: ARIA, GOOGLE, NEURAL...">
        <div class="v-drop" id="v-drop"></div>
    </div>

    <div class="input-group">
        <label>02 // COMMAND BUFFER (MANUAL OVERRIDE)</label>
        <textarea id="v-text" placeholder="ENTER MISSION PARAMETERS OR DIALOGUE...">MISSION COMPLETE. SECTOR 7 IS SECURE. RETURNING TO BASE FOR REFUELING.</textarea>
    </div>

    <button class="btn-fire" onclick="executeVoice()">[ EXECUTE BROADCAST ]</button>

    <div class="matrix-debug">
        <div>CHANNELS: <span class="stat-val" id="st-count">0</span></div>
        <div>ACTIVE: <span class="stat-val" id="st-active">NONE</span></div>
        <div>ENCODING: <span class="stat-val">PCM_RAW</span></div>
        <div>BUFFER: <span class="stat-val">READY</span></div>
    </div>
</div>

<script>
    const synth = window.speechSynthesis;
    const searchInput = document.getElementById('v-search');
    const dropMenu = document.getElementById('v-drop');
    const textInput = document.getElementById('v-text');
    
    let allVoices = [];
    let selectedVoice = null;

    function initVoices() {
        allVoices = synth.getVoices().sort((a,b) => b.name.includes('Online') - a.name.includes('Online'));
        document.getElementById('st-count').innerText = allVoices.length;
        renderList("");
    }

    function renderList(filter) {
        const query = filter.toLowerCase();
        dropMenu.innerHTML = '';
        const filtered = allVoices.filter(v => v.name.toLowerCase().includes(query));

        filtered.forEach(v => {
            const div = document.createElement('div');
            div.className = 'v-opt';
            const tag = v.name.includes('Online') ? '◆' : '◇';
            div.innerHTML = `<span>${tag} ${v.name}</span> <span style="opacity:0.4">${v.lang}</span>`;
            div.onclick = () => {
                selectedVoice = v;
                searchInput.value = v.name;
                document.getElementById('st-active').innerText = v.name.split(' ')[0];
                dropMenu.classList.remove('active');
            };
            dropMenu.appendChild(div);
        });
    }

    searchInput.onfocus = () => {
        if (!allVoices.length) initVoices();
        dropMenu.classList.add('active');
    };
    searchInput.oninput = (e) => renderList(e.target.value);

    // Close on blur
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.input-group')) dropMenu.classList.remove('active');
    });

    function executeVoice() {
        if (!selectedVoice) {
            // Auto-pick first neural voice if none selected
            selectedVoice = allVoices.find(v => v.name.includes('Online')) || allVoices[0];
            searchInput.value = selectedVoice.name;
        }

        const utter = new SpeechSynthesisUtterance(textInput.value);
        utter.voice = selectedVoice;
        utter.rate = 0.9;
        
        synth.cancel(); // Critical: Clears previous audio "hangs"
        synth.speak(utter);
    }

    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = initVoices;
    }
    
    // Wake up the engine immediately
    window.onload = () => {
        const silent = new SpeechSynthesisUtterance("");
        synth.speak(silent);
        initVoices();
    };
</script>

</body>
</html>